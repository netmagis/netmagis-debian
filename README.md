Tools for Netmagis Debian package creation
==========================================

How to make Debian packages for Netmagis
----------------------------------------

### Prerequisites

Tools in this directory make the following assumptions:

  - Docker is installed
  - you must belong to the `docker` Unix group
  - Netmagis source directory must be available (e.g. in `../netmagis/`)
  - the Netmagis source directory must contains the netmagis-_version_.tar.gz
    generated by `make distrib` at Netmagis top level (e.g. in `../netmagis/`)
  - you don't need to be `root` to use these tools

### Directories

This repository contains the following directories:

  - `build`: Docker environment to build Debian packages
  - `test`: Docker environment to test generated packages
  - `debian`: set of script/configuration files to create Debian packages

### The main command

The `mkpkg` command is the main tool, which uses 2 Docker images.


How to release Debian packages for a given Netmagis version
-----------------------------------------------------------

1. create a PGP key for testing (or distribution) purpose:

    ```
    gpg --quick-gen-key --batch --passphrase "" "Joe USER <joe@example.com>"
    ```

    Check this key:

    ```
    gpg --list-keys
    ```

2. check that the Netmagis source directory is up-to-date and version
    is expected:

    ```
    cd ../netmagis
    git pull --all
    git checkout                 # use the appropriate branch or tag
    make version
    ```

3. build packages and test a pseudo-installation

    ```
    cd ../netmagis-debian
    ./mkpkg ../netmagis . joe@example.com image run clean
    ```

    Built packages and repository are located in `tests` subdirectory.

4. transfer the repository to the distribution server

    ```
    cd ../netmagis-debian/tmp
    tar cf - repo | ssh netmagis.org tar xvf - -C FIXME
    ```
